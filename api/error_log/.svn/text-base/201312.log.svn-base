2013-12-01 13:37:10	1	insert into rdrecords (autoid,id,ifnum,ifquantity,innum,inquantity,inum,iquantity,isoutnum,cbvencode,cdefine26,cdefine27,cinvcode,cposition) values ('1577','203','0','0','0','0','0','25.0000','0','','25.0000','0','0102010401','')
2013-12-02 14:05:16	1	insert into rdrecords (autoid,id,ifnum,ifquantity,innum,inquantity,inum,iquantity,isoutnum,cbvencode,cdefine26,cdefine27,cinvcode,cposition) values ('2003','256','0','0','0','0','0','2.0000','0','','2.0000','0','01020602','')
2013-12-03 13:48:58	1	insert into rdrecords (autoid,id,ifnum,ifquantity,innum,inquantity,inum,iquantity,isoutnum,cbvencode,cdefine26,cdefine27,cinvcode,cposition) values ('2785','330','0','0','0','0','0','30.0000','0','','30.0000','0','01020403','')
2013-12-03 14:31:04	1	insert into rdrecords (autoid,id,ifnum,ifquantity,innum,inquantity,inum,iquantity,isoutnum,cbvencode,cdefine26,cdefine27,cinvcode,cposition) values ('3105','342','0','0','0','0','0','5.0000','0','','5.0000','0','0102010101','')
2013-12-04 14:05:34	1	insert into rdrecords (autoid,id,ifnum,ifquantity,innum,inquantity,inum,iquantity,isoutnum,cbvencode,cdefine26,cdefine27,cinvcode,cposition) values ('3493','387','0','0','0','0','0','4.0000','0','','4.0000','0','0102010101','')
2013-12-04 14:56:54	1	insert into rdrecords (autoid,id,ifnum,ifquantity,innum,inquantity,inum,iquantity,isoutnum,cbvencode,cdefine26,cdefine27,cinvcode,cposition) values ('3733','403','0','0','0','0','0','2.0000','0','','2.0000','0','0102010201','')
2013-12-05 13:50:45	1	insert into rdrecords (autoid,id,ifnum,ifquantity,innum,inquantity,inum,iquantity,isoutnum,cbvencode,cdefine26,cdefine27,cinvcode,cposition) values ('4084','503','0','0','0','0','0','7.0000','0','','7.0000','0','0102010401','')
2013-12-05 14:15:36	1	insert into rdrecords (autoid,id,ifnum,ifquantity,innum,inquantity,inum,iquantity,isoutnum,cbvencode,cdefine26,cdefine27,cinvcode,cposition) values ('209132','53635','0','0','0','0','0','15.0000','0','','15.0000','0','01020406','')
2013-12-05 14:23:28	1	insert into rdrecords (autoid,id,ifnum,ifquantity,innum,inquantity,inum,iquantity,isoutnum,cbvencode,cdefine26,cdefine27,cinvcode,cposition) values ('209175','53639','0','0','0','0','0','3.0000','0','','3.0000','0','0102010101','')
2013-12-06 13:00:29	1	insert into rdrecords (autoid,id,ifnum,ifquantity,innum,inquantity,inum,iquantity,isoutnum,cbvencode,cdefine26,cdefine27,cinvcode,cposition) values ('209358','53656','0','0','0','0','0','4.0000','0','','4.0000','0','0102010101','')
2013-12-06 14:01:36	1	insert into rdrecords (autoid,id,ifnum,ifquantity,innum,inquantity,inum,iquantity,isoutnum,cbvencode,cdefine26,cdefine27,cinvcode,cposition) values ('209554','53665','0','0','0','0','0','8.0000','0','','8.0000','0','01010606','')
2013-12-06 14:23:22	1	insert into rdrecords (autoid,id,ifnum,ifquantity,innum,inquantity,inum,iquantity,isoutnum,cbvencode,cdefine26,cdefine27,cinvcode,cposition) values ('209661','53669','0','0','0','0','0','50.0000','0','','50.0000','0','01020403','')
2013-12-07 14:06:54	1	insert into rdrecords (autoid,id,ifnum,ifquantity,innum,inquantity,inum,iquantity,isoutnum,cbvencode,cdefine26,cdefine27,cinvcode,cposition) values ('209872','53751','0','0','0','0','0','1.0000','0','','1.0000','0','0102010201','')
2013-12-08 13:09:15	1	insert into rdrecords (autoid,id,ifnum,ifquantity,innum,inquantity,inum,iquantity,isoutnum,cbvencode,cdefine26,cdefine27,cinvcode,cposition) values ('210198','53773','0','0','0','0','0','4.0000','0','','4.0000','0','0102010101','')
2013-12-09 13:52:47	1	insert into rdrecords (autoid,id,ifnum,ifquantity,innum,inquantity,inum,iquantity,isoutnum,cbvencode,cdefine26,cdefine27,cinvcode,cposition) values ('210488','53790','0','0','0','0','0','20.0000','0','','20.0000','0','0101060401','')
2013-12-09 14:50:59	1	insert into rdrecords (autoid,id,ifnum,ifquantity,innum,inquantity,inum,iquantity,isoutnum,cbvencode,cdefine26,cdefine27,cinvcode,cposition) values ('210746','53801','0','0','0','0','0','20.0000','0','','20.0000','0','0102010401','')
2013-12-10 12:58:40	1	insert into rdrecords (autoid,id,ifnum,ifquantity,innum,inquantity,inum,iquantity,isoutnum,cbvencode,cdefine26,cdefine27,cinvcode,cposition) values ('210858','53810','0','0','0','0','0','4.0000','0','','4.0000','0','0102010101','')
2013-12-11 16:31:42	1	insert into rdrecords (autoid,id,ifnum,ifquantity,innum,inquantity,inum,iquantity,isoutnum,cbvencode,cdefine26,cdefine27,cinvcode,cposition) values ('211175','53835','0','0','0','0','0','15.0000','0','','15.0000','0','0102010401','')
2013-12-12 12:53:50	1	select 
        grouping(a.ch_branchno) as istotal,
sum(case when a.ch_presentflag='N' then ((num_num - num_back) * num_price + num_price_add) * a.int_discount/100 else 0 end)  as total,
sum(case when CONVERT(varchar(12) , a.dt_operdate, 114 ) < '10:00:00' then (num_num - num_back) * num_price + num_price_add else 0 end) as zaocan,
sum(case when CONVERT(varchar(12) , a.dt_operdate, 114 ) < '15:30:00' 
	and CONVERT(varchar(12) , a.dt_operdate, 114 ) >= '10:00:00' 
	then 
	(num_num-num_back)*num_price else 0 end) as wucan,
sum(case when CONVERT(varchar(12) , a.dt_operdate, 114 ) >= '15:30:00' then (num_num - num_back) * num_price + num_price_add else 0  end) as wancan,
sum(case  when b.ch_suitflag='Y' and f.dishnums>2 then (num_num-num_back)*num_price else 0  end) as taocan,

sum(case when b.ch_seriesno =06 then (num_num - num_back) * num_price + num_price_add else 0  end) as cuxiao,
sum(case WHEN   b.ch_typeno=61  then (num_num - num_back) * num_price + num_price_add else 0  end) as cuxiao_changgui,
sum(case WHEN  b.ch_typeno=64  then (num_num - num_back) * num_price + num_price_add else 0  end) as cuxiao_wucan,
sum(case WHEN   b.ch_typeno=65   then (num_num - num_back) * num_price + num_price_add else 0  end) as cuxiao_tuangou,
sum(case WHEN  b.ch_suitflag='Y' AND b.ch_seriesno=06 and f.dishnums>2  then (num_num - num_back) * num_price + num_price_add else 0  end) as cuxiao_taocan,

cast(sum(case when b.ch_seriesno='05' then (num_num - num_back) * num_price + num_price_add else 0  end) as numeric(11,2)) as type_zaocan,
cast(sum(case when b.ch_seriesno='01' then (num_num - num_back) * num_price + num_price_add else 0  end) as numeric(11,2)) as type_fanpin,
cast(sum(case when b.ch_seriesno='04' then (num_num - num_back) * num_price + num_price_add else 0  end) as numeric(11,2)) as type_yinpin,
cast(sum(case when b.ch_seriesno='03' then (num_num - num_back) * num_price + num_price_add else 0  end) as numeric(11,2)) as type_fupin,


'discount' = sum(((num_num - num_back) * num_price + num_price_add) * (100 - int_discount) * 0.01), 
sum(case when
	b.ch_dishno = '11008' then 0
	when b.ch_dishno ='13007' then 0
	when b.ch_typeno='13' then (a.num_num- a.num_back) * -1
	when b.ch_typeno='23' then -(a.num_num- a.num_back)
	when b.ch_typeno='11' or b.ch_typeno='21' then (a.num_num-a.num_back)   
	else 0 end) as keliuliang,
    
a.ch_branchno

from 

cybr_bt_dish b,
cyhq_u_orderdish a,
cyhq_u_checkout_master d,
(
select (select count(*) from cybr_bt_dish_suit where ch_suitno=g.ch_dishno) as dishnums,ch_dishno
from cybr_bt_dish g
) f

where 
d.dt_operdate > 'NaN-aN-aN 00:00:00'
and d.dt_operdate < 'NaN-aN-aN 23:59:59'
and a.ch_dishno = b.ch_dishno
and a.ch_branchno = d.ch_branchno
and a.ch_payno = d.ch_payno
and f.ch_dishno = b.ch_dishno
group by a.ch_branchno with rollup
having sum(num_num - num_back) <> 0
order by a.ch_branchno asc
2013-12-12 13:51:26	1	insert into rdrecords (autoid,id,ifnum,ifquantity,innum,inquantity,inum,iquantity,isoutnum,cbvencode,cdefine26,cdefine27,cinvcode,cposition) values ('211563','53901','0','0','0','0','0','30.0000','0','','30.0000','0','0101010103','')
2013-12-12 14:44:01	1	insert into rdrecords (autoid,id,ifnum,ifquantity,innum,inquantity,inum,iquantity,isoutnum,cbvencode,cdefine26,cdefine27,cinvcode,cposition) values ('211828','53935','0','0','0','0','0','2.0000','0','','2.0000','0','01010502','')
2013-12-13 14:19:55	1	insert into rdrecords (autoid,id,ifnum,ifquantity,innum,inquantity,inum,iquantity,isoutnum,cbvencode,cdefine26,cdefine27,cinvcode,cposition) values ('211965','53945','0','0','0','0','0','25.0000','0','','25.0000','0','01020403','')
2013-12-14 14:01:46	1	insert into rdrecords (autoid,id,ifnum,ifquantity,innum,inquantity,inum,iquantity,isoutnum,cbvencode,cdefine26,cdefine27,cinvcode,cposition) values ('212273','53959','0','0','0','0','0','7.0000','0','','7.0000','0','0102010101','')
2013-12-14 14:20:14	1	insert into rdrecords (autoid,id,ifnum,ifquantity,innum,inquantity,inum,iquantity,isoutnum,cbvencode,cdefine26,cdefine27,cinvcode,cposition) values ('212416','53965','0','0','0','0','0','1.0000','0','','1.0000','0','0102010101','')
2013-12-14 14:54:13	1	insert into rdrecords (autoid,id,ifnum,ifquantity,innum,inquantity,inum,iquantity,isoutnum,cbvencode,cdefine26,cdefine27,cinvcode,cposition) values ('212473','53968','0','0','0','0','0','4.0000','0','','4.0000','0','0102010101','')
2013-12-14 15:11:28	1	insert into rdrecords (autoid,id,ifnum,ifquantity,innum,inquantity,inum,iquantity,isoutnum,cbvencode,cdefine26,cdefine27,cinvcode,cposition) values ('212530','53977','0','0','0','0','0','4.0000','0','','4.0000','0','0102010101','')
2013-12-15 13:52:34	1	insert into rdrecords (autoid,id,ifnum,ifquantity,innum,inquantity,inum,iquantity,isoutnum,cbvencode,cdefine26,cdefine27,cinvcode,cposition) values ('212696','53985','0','0','0','0','0','160.0000','0','','160.0000','0','01010704','')
2013-12-17 14:19:35	1	insert into rdrecords (autoid,id,ifnum,ifquantity,innum,inquantity,inum,iquantity,isoutnum,cbvencode,cdefine26,cdefine27,cinvcode,cposition) values ('213340','54039','0','0','0','0','0','3.0000','0','','3.0000','0','01010502','')
2013-12-18 13:46:01	1	insert into rdrecords (autoid,id,ifnum,ifquantity,innum,inquantity,inum,iquantity,isoutnum,cbvencode,cdefine26,cdefine27,cinvcode,cposition) values ('213742','54112','0','0','0','0','0','3.0000','0','','3.0000','0','0102010101','')
2013-12-19 14:39:27	1	insert into rdrecords (autoid,id,ifnum,ifquantity,innum,inquantity,inum,iquantity,isoutnum,cbvencode,cdefine26,cdefine27,cinvcode,cposition) values ('214112','54155','0','0','0','0','0','90.0000','0','','90.0000','0','01010807','')
2013-12-20 14:12:28	1	insert into rdrecords (autoid,id,ifnum,ifquantity,innum,inquantity,inum,iquantity,isoutnum,cbvencode,cdefine26,cdefine27,cinvcode,cposition) values ('214449','54177','0','0','0','0','0','40.0000','0','','40.0000','0','0101060401','')
2013-12-20 14:50:53	1	insert into rdrecords (autoid,id,ifnum,ifquantity,innum,inquantity,inum,iquantity,isoutnum,cbvencode,cdefine26,cdefine27,cinvcode,cposition) values ('214679','54189','0','0','0','0','0','90.0000','0','','90.0000','0','01010807','')
2013-12-21 13:23:23	1	insert into rdrecords (autoid,id,ifnum,ifquantity,innum,inquantity,inum,iquantity,isoutnum,cbvencode,cdefine26,cdefine27,cinvcode,cposition) values ('214846','54226','0','0','0','0','0','6.0000','0','','6.0000','0','04040201','')
2013-12-22 12:53:56	1	insert into rdrecords (autoid,id,ifnum,ifquantity,innum,inquantity,inum,iquantity,isoutnum,cbvencode,cdefine26,cdefine27,cinvcode,cposition) values ('215176','54245','0','0','0','0','0','3.0000','0','','3.0000','0','0102010101','')
2013-12-23 13:44:36	1	insert into rdrecords (autoid,id,ifnum,ifquantity,innum,inquantity,inum,iquantity,isoutnum,cbvencode,cdefine26,cdefine27,cinvcode,cposition) values ('215501','54288','0','0','0','0','0','1.0000','0','','1.0000','0','0102010201','')
2013-12-23 15:07:40	1	insert into rdrecords (autoid,id,ifnum,ifquantity,innum,inquantity,inum,iquantity,isoutnum,cbvencode,cdefine26,cdefine27,cinvcode,cposition) values ('215768','54299','0','0','0','0','0','3.0000','0','','3.0000','0','01020210','')
2013-12-24 13:36:31	1	insert into rdrecords (autoid,id,ifnum,ifquantity,innum,inquantity,inum,iquantity,isoutnum,cbvencode,cdefine26,cdefine27,cinvcode,cposition) values ('215869','54308','0','0','0','0','0','3.0000','0','','3.0000','0','0102010101','')
2013-12-24 14:48:18	1	insert into rdrecords (autoid,id,ifnum,ifquantity,innum,inquantity,inum,iquantity,isoutnum,cbvencode,cdefine26,cdefine27,cinvcode,cposition) values ('215912','54311','0','0','0','0','0','3.0000','0','','3.0000','0','0102010101','')
2013-12-25 15:55:11	1	insert into rdrecords (autoid,id,ifnum,ifquantity,innum,inquantity,inum,iquantity,isoutnum,cbvencode,cdefine26,cdefine27,cinvcode,cposition) values ('216226','54357','0','0','0','0','0','3.0000','0','','3.0000','0','0102010101','')
2013-12-26 16:57:36	1	insert into rdrecords (autoid,id,ifnum,ifquantity,innum,inquantity,inum,iquantity,isoutnum,cbvencode,cdefine26,cdefine27,cinvcode,cposition) values ('216511','54372','0','0','0','0','0','22.0000','0','','22.0000','0','01010617','')
2013-12-29 15:17:13	1	insert into rdrecords (autoid,id,ifnum,ifquantity,innum,inquantity,inum,iquantity,isoutnum,cbvencode,cdefine26,cdefine27,cinvcode,cposition) values ('217601','54461','0','0','0','0','0','2.0000','0','','2.0000','0','01010502','')
2013-12-30 14:16:27	1	insert into rdrecords (autoid,id,ifnum,ifquantity,innum,inquantity,inum,iquantity,isoutnum,cbvencode,cdefine26,cdefine27,cinvcode,cposition) values ('218134','54551','0','0','0','0','0','.0000','0','','10.0000','0','040705','')
2013-12-31 15:56:08	1	insert into rdrecords (autoid,id,ifnum,ifquantity,innum,inquantity,inum,iquantity,isoutnum,cbvencode,cdefine26,cdefine27,cinvcode,cposition) values ('218421','54579','0','0','0','0','0','3.0000','0','','3.0000','0','01020210','')
2013-12-31 19:35:27	1	insert into rdrecords (autoid,id,ifnum,ifquantity,innum,inquantity,inum,iquantity,isoutnum,cbvencode,cdefine26,cdefine27,cinvcode,cposition) values ('218517','54583','0','0','0','0','0','4.0000','0','','4.0000','0','01020211','')
2013-12-31 20:30:27	1	insert into rdrecords (autoid,id,ifnum,ifquantity,innum,inquantity,inum,iquantity,isoutnum,cbvencode,cdefine26,cdefine27,cinvcode,cposition) values ('218842','54594','0','0','0','0','0','12.0000','0','','12.0000','0','01010812','')
